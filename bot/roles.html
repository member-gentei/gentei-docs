<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Roles and Enforcement</title>
    <meta name="description" content="Documentation for Gentei">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/assets/normalize.css?v=1660883876"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/doctave-style.css?v=1660883876"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/katex.css?v=1660883876" media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/prism-ghcolors.css?v=1660883876"
        media="screen" />

    <script>
        var DOCTAVE_TIMESTAMP = "1660883876";
        var BASE_PATH = "/";
        var color = localStorage.getItem('doctave-color')

        if (color === 'dark') {
            document.getElementsByTagName('html')[0].classList.remove('light');
            document.getElementsByTagName('html')[0].classList.add('dark');
        } else {
            document.getElementsByTagName('html')[0].classList.remove('dark');
            document.getElementsByTagName('html')[0].classList.add('light');
        }
    </script>

    
</head>

<body>
    <label for='menu-toggle-switch' class='menu-toggle-button'>
        ☰
    </label>
    <input type="checkbox" id="menu-toggle-switch" value='0' />
    <div class='page'>
        <div class='header'>
            <div class='logo'>
                
                <h2 class='project-name'>
                    <a href="/">
                        Gentei
                    </a>
                </h2>
            </div>
            <div class='search'>
                <form id='search-form'>
    <input type='text' id='search-box' autocomplete="off" placeholder="Search..."></input>
    <span class='search-icon'>S</span>
    <ul id='search-results'></ul>
</form>

            </div>
            <div class='header-dummy-right'>
            </div>
        </div>
        <div class='container'>
            <div class='sidebar-left'>
                <nav class='site-nav'>
    <ul>
        
            <li><a href="/bot">Discord bot</a></li>
            
                <ul>
    
        <li><a class="active" href="/bot/roles">Roles and Enforcement</a></li>
        
    
        <li><a href="/bot/commands">Slash commands</a></li>
        
    
        <li><a href="/bot/audit">Audit log</a></li>
        
    
</ul>

            
        
            <li><a href="/youtube-oauth">YouTube Permissions</a></li>
            
        
            <li><a href="/faq">FAQ</a></li>
            
        
    </ul>
    <span id='light-dark-mode-switch'>
        <svg xmlns="http://www.w3.org/2000/svg" id="dark-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" id="light-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
        </svg>
    </span>
</nav>

            </div>
            <div class='doctave-content'>
                <h1 id="gentei-managed-roles">Gentei-managed roles</h1>
<p>Gentei-managed roles are roles that Gentei establishes sole membership control over. Establishing exclusive control over this role is important because it keeps role management as simple as possible, which in turn prevents confusion about why someone does or does not have a role.</p>
<p>Put another way, Gentei regularly overwrites the entire role membership list with its own, internal list of which users should have this role.</p>
<div class="callout info"><p class="callout-title">Vocabulary note</p>
<p>
For the rest of this page, "role" will only ever refer to a Gentei-managed role.
</p>
</div><h1 id="enforcement">Enforcement</h1>
<p>Gentei performs role enforcement <em>about</em> once a day to maintain role mapping integrity. </p>
<p>In general, the bot is told to enforce roles at the end of a daily job that performs membership checks for all users. As of 2022/03/21, this job starts around ~1PM Pacific Time.</p>
<h2 id="process-walkthrough">Process walkthrough</h2>
<p>When told to enforce roles, the bot goes through all of the non-disabled roles that it has configured. (Enforcement for a role is disabled when membership checks are disabled for the corresponding YouTube channel.)</p>
<p>For each user that holds the role:</p>
<ol>
<li>If a user is not registered with Gentei, the user is removed from the role.</li>
<li>If a user is registered with Gentei and failed a membership check...
<ol>
<li>...within the role's grace period, no  changes are made. The user will be DM'd about the check failure to give them an opportunity to renew their membership. (the default grace period is 1 calendar day)</li>
<li>...past the role's grace period, the user is removed from the role if the user has the role. </li>
</ol>
</li>
</ol>
<p>For each Gentei-registered user in the Discord server that does not have the role:</p>
<ol>
<li>If the user passed a membership check, they are granted the role.</li>
</ol>
<h2 id="grace-period">Grace period</h2>
<div class="callout info"><p class="callout-title">Coming soon</p>
<p>
Configurable grace periods and membership loss warnings are not yet implemented, and all roles currently use the default setting of 1 calendar day. Please treat this section as a proposal and feel free to leave feedback in the <code>#gentei-限定</code> channel!
</p>
</div>
<p>Grace periods allow users that currently hold roles to fail checks for a certain period of time. The only unit of time that can be configured is a calendar day, and each calendar day aligns to UTC timezone.</p>
<p>Admins/mods can configure grace periods that are more/less strict than the default of <strong>1 calendar day</strong>. </p>
<h3 id="calendar-day-behavior">Calendar day behavior</h3>
<p>Calendar day grace periods are best explained by example. For example, say that a user has verified their last day of membership for a channel at 23:59 UTC on January 1. This channel is mapped to 2 different verified membership roles that this user holds:</p>
<ul>
<li><code>@Smol</code> - with the default grace period of 1 day.</li>
<li><code>@Long</code> - with a grace period of 7 days.</li>
</ul>
<p>On January 2, this user fails a membership check because January 1 was their last day. Gentei does not make any changes, but stores the first day that the check failed. When the bot performs role enforcement on January 2, it will DM this user about losing their membership to <code>@Smol</code> tomorrow if a check on January 3 fails.</p>
<p>On January 3, this user fails a membership check again. When the bot performs role enforcement on January 3, it removes this user from the <code>@Smol</code> role.</p>
<p>On January 8 - on the 7th day of the grace period for <code>@Long</code> - the bot will DM this user about losing their membership to <code>@Long</code> tomorrow.</p>
<p>On January 9, this user loses their membership to <code>@Long</code> during role enforcement.</p>
<h2 id="user-lifecycle-notes">User lifecycle notes</h2>
<p>In response to behavior that confused both users and Discord moderation teams in v1, v2's user deletion process now immediately removes Gentei-managed roles from deleted users. The bot then attempts to DM the user to confirm account deletion, but proceeds with deletion regardless.</p>

            </div>
            <div class='sidebar-right'>
                <div class='page-nav' id='page-nav'>
                    <p class='page-nav-header'>On this page</p>
                    <ul>
                        
                        <li class='page-nav-level-1'>
                            <a href='#gentei-managed-roles'>Gentei-managed roles</a>
                        </li>
                        
                        <li class='page-nav-level-1'>
                            <a href='#enforcement'>Enforcement</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#process-walkthrough'>Process walkthrough</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#grace-period'>Grace period</a>
                        </li>
                        
                        <li class='page-nav-level-3'>
                            <a href='#calendar-day-behavior'>Calendar day behavior</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#user-lifecycle-notes'>User lifecycle notes</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
            <div class='wave-container'>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill-opacity="0.35"
                        d="M0,192L60,213.3C120,235,240,277,360,277.3C480,277,600,235,720,192C840,149,960,107,1080,122.7C1200,139,1320,213,1380,250.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.5"
                        d="M0,160L60,181.3C120,203,240,245,360,229.3C480,213,600,139,720,138.7C840,139,960,213,1080,229.3C1200,245,1320,203,1380,181.3L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.2"
                        d="M0,224L60,197.3C120,171,240,117,360,117.3C480,117,600,171,720,186.7C840,203,960,181,1080,186.7C1200,192,1320,224,1380,240L1440,256L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                </svg>
                <p>Powered by <a href='https://cli.doctave.com' target='_blank'>Doctave</a></p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/assets/katex.js?v=1660883876"></script>
    <script type="text/javascript" src="/assets/mermaid.js?v=1660883876"></script>
    <script type="text/javascript" src="/assets/elasticlunr.js?v=1660883876"></script>
    <script type="text/javascript" src="/assets/prism.js?v=1660883876"></script>
    <script type="text/javascript" src="/assets/doctave-app.js?v=1660883876"></script>

    
</body>

</html>